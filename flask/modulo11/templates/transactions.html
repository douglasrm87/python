{% extends "base.html" %}

{% block title %}Histórico de Transações - Banco Online{% endblock %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 1.5rem;">Histórico de Transações</h2>
    <div class="transaction-list">
        {% for transaction in transactions %}
        <div class="transaction-item">
            <div>
                <div class="transaction-type">
                    {% if transaction.transaction_type == 'deposit' %}
                        Depósito
                    {% elif transaction.transaction_type == 'withdrawal' %}
                        Saque
                    {% else %}
                        {{ transaction.transaction_type|title }}
                    {% endif %}
                </div>
                <div class="transaction-date">{{ transaction.timestamp.strftime('%d/%m/%Y %H:%M:%S') }}</div>
            </div>
            <div class="transaction-amount {{ transaction.transaction_type }}">
                {% if transaction.transaction_type == 'deposit' %}+{% else %}-{% endif %}
                R$ {{ "%.2f"|format(transaction.amount) }}
            </div>
        </div>
        {% else %}
        <p>Nenhuma transação encontrada</p>
        {% endfor %}
    </div>
    <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Voltar para o Painel</a>
        <a href="{{ url_for('export_transactions') }}" class="btn btn-primary" style="background-color: #047857;">
            Exportar Transações
        </a>
        <form action="{{ url_for('import_transactions') }}" method="POST" enctype="multipart/form-data" style="display: inline;">
            <input type="file" name="file" id="file" accept=".txt" style="display: none;" onchange="this.form.submit()">
            <button type="button" class="btn btn-primary" style="background-color: #4f46e5;" onclick="document.getElementById('file').click()">
                Importar Transações
            </button>
        </form>
    </div>
</div>

<!-- Modal de ajuda para importação -->
<div id="importHelpModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Como Importar Transações</h3>
        <p>O arquivo de importação deve estar no seguinte formato:</p>
        <pre>
Date: YYYY-MM-DD HH:MM:SS
Type: deposit/withdrawal
Amount: $XX.XX
---------------------
        </pre>
        <button onclick="closeModal()" class="btn btn-primary">Fechar</button>
    </div>
</div>

<style>
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    max-width: 500px;
    width: 90%;
}

pre {
    background-color: #f3f4f6;
    padding: 1rem;
    border-radius: 0.375rem;
    overflow-x: auto;
}
</style>

<script>
function showImportHelp() {
    document.getElementById('importHelpModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('importHelpModal').style.display = 'none';
}

// Fechar modal ao clicar fora dele
window.onclick = function(event) {
    var modal = document.getElementById('importHelpModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>
{% endblock %}